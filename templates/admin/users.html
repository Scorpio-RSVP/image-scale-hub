{% extends "admin/base.html" %}
{% block title %}Users{% endblock %}

{% block content %}
<h2 class="section-title">ðŸ‘¥ User Management</h2>

<form method="POST" action="{{ url_for('admin.create_user') }}" style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
    <h3 style="margin-bottom: 15px;">âž• Add New User</h3>
    <div class="form-row">
        <div class="form-group">
            <label>Username</label>
            <input type="text" name="username" class="form-control" required>
        </div>
        <div class="form-group">
            <label>Email</label>
            <input type="email" name="email" class="form-control" required>
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" name="password" class="form-control" required>
        </div>
    </div>
    <div class="form-group">
        <label><input type="checkbox" name="is_admin"> Administrator</label>
    </div>
    <button type="submit" class="btn btn-success">Create User</button>
</form>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% set user_list = users.items if users.items is defined else users %}
        {% for u in user_list %}
        <tr>
            <td>{{ u.id }}</td>
            <td><strong>{{ u.username }}</strong></td>
            <td>{{ u.email or '-' }}</td>
            <td>
                {% if u.is_admin %}
                <span class="badge badge-admin">Admin</span>
                {% else %}
                <span class="badge badge-user">User</span>
                {% endif %}
            </td>
            <td>{{ u.created_at.strftime('%Y-%m-%d') }}</td>
            <td class="actions">
                <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;" onclick="toggleAdmin({{ u.id }})">
                    {% if u.is_admin %}Demote{% else %}Promote{% endif %}
                </button>
                <form method="POST" action="{{ url_for('admin.delete_user', user_id=u.id) }}" style="display: inline;" onsubmit="return confirm('Delete {{ u.username }}?');">
                    <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No users found</td></tr>
        {% endfor %}
    </tbody>
</table>

<script>
function toggleAdmin(userId) {
    fetch(`/admin/users/${userId}/toggle-admin`, { method: 'POST' })
        .then(r => r.json())
        .then(d => { if(d.success) location.reload(); else alert(d.error); });
}
</script>
{% endblock %}
